(this["webpackJsonpvoronoi-analyzer"]=this["webpackJsonpvoronoi-analyzer"]||[]).push([[0],{71:function(e,t,n){},72:function(e,t,n){},74:function(e,t,n){},76:function(e,t,n){},84:function(e,t){},85:function(e,t,n){},86:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),i=n(35),c=n.n(i),s=n(5),o=(n(71),n(72),n.p+"static/media/help.d27c6caa.svg"),l=n(6),d=n.p+"static/media/footer-download.806ab3cb.svg",h=n.p+"static/media/coefficient.f07f7e6d.svg",f=n.p+"static/media/skewness.d4c26804.svg",u=(n(74),n.p+"static/media/download.a3498030.svg"),j=n.p+"static/media/voronoi-analyzer-example.c3f96403.csv",b=n(0);var p=function(){return Object(b.jsxs)("div",{className:"information-container",children:[Object(b.jsx)("h1",{children:"Usage"}),Object(b.jsxs)("ol",{children:[Object(b.jsxs)("li",{className:"upload-instructions",children:[Object(b.jsx)("span",{children:'Upload a CSV file of the coordinates. The first record must be a header, and it must contain the field names "x" and "y" exactly.'}),Object(b.jsxs)("span",{children:[Object(b.jsx)("a",{href:j,download:"voronoi-analyzer-example.csv",children:Object(b.jsx)("img",{className:"icon",src:u,alt:"download example csv"})}),"Download example CSV"]})]}),Object(b.jsx)("li",{children:"Click on any of the boxes for an expanded view."}),Object(b.jsxs)("li",{children:["Download the visuals and the related data using the ",Object(b.jsx)("img",{className:"icon",src:d,alt:"download"})," button in the footer."]})]}),Object(b.jsx)("h1",{children:"Info"}),Object(b.jsxs)("ul",{children:[Object(b.jsxs)("li",{children:["Welcome to Voronoi Analyzer, an app that generates the ",Object(b.jsx)("a",{href:"https://en.wikipedia.org/wiki/Voronoi_diagram",target:"_blank",rel:"noreferrer",children:"Voronoi diagram"})," of a given set of coordinates and performs statistical analysis on the areas of the resulting polygons. You can use it, for instance, to examine the density of cells, nuclei, etc. in micrographs. It is not, however, intended to substitute the likes of MATLAB."]}),Object(b.jsx)("li",{children:"Cells around the edges are artificially clipped for display, but not for calculations: Infinite cells are not factored into the histogram, skewness, or coefficient."}),Object(b.jsx)("li",{children:"Negative coordinates are welcome."}),Object(b.jsxs)("li",{className:"formula-li",children:[Object(b.jsx)("span",{children:"The formula for quantifying skewness is:"}),Object(b.jsx)("img",{src:f,alt:"g\\index{i}=\\frac{\\frac{1|n} \\sum{n|i=1} (x\\index{i} - \\overline{x})\\power{3}|(\\frac{1|n} \\sum{n|i=1} (x\\index{i} - \\overline{x})\\power{2})\\power{3/2}}"}),Object(b.jsxs)("span",{children:["where x",Object(b.jsx)("sub",{children:"i"})," is the area of the i",Object(b.jsx)("sup",{children:"th"})," domain and x\u0304 is the sample mean.",Object(b.jsx)("span",{className:"asterisk",children:" *"})]})]}),Object(b.jsxs)("li",{className:"formula-li",children:[Object(b.jsx)("span",{children:"The coefficient of clustering is determined by the ratio between the global coefficient of variance and the average local coefficient of variance in domain sizes. The formula is:"}),Object(b.jsx)("img",{src:h,alt:"c=\\frac{n\\overline{x}|\ud835\udf0e\\index{x} \\sum{n|i=1} \\frac{\\overline{a\\index{i}}|\ud835\udf0e\\index{a\\index{i}}} }"}),Object(b.jsxs)("span",{children:["where \u03c3",Object(b.jsx)("sub",{children:"x"})," is the standard deviation of all the domains, and \u0101 and \u03c3",Object(b.jsxs)("sub",{children:["a",Object(b.jsx)("sub",{children:"i"})]})," are the mean and the standard deviation of the size of neighboring domains of i",Object(b.jsx)("sup",{children:"th"})," domain, respectively.",Object(b.jsx)("span",{className:"asterisk",children:" *  "}),"Because a domain with one or no finite neighbors would have 0 as its \u03c3",Object(b.jsxs)("sub",{children:["a",Object(b.jsx)("sub",{children:"i"})]})," and would then force the coefficient to asymptotically become 0, only domains with more than one finite neighbor are factored into the calculation."]})]}),Object(b.jsxs)("li",{children:["Check out the public ",Object(b.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://github.com/hein-j/voronoi-analyzer",children:"Github repo"}),". Issues and pull requests welcome."]})]}),Object(b.jsx)("h1",{children:"Acknowledgements"}),Object(b.jsxs)("ul",{children:[Object(b.jsxs)("li",{children:["Big thanks to the ",Object(b.jsx)("a",{href:"https://d3js.org",rel:"noreferrer",target:"_blank",children:"D3.js"})," library for the data visualization tools."]}),Object(b.jsxs)("li",{children:[Object(b.jsx)("span",{className:"asterisk",children:"*"})," \u2014 The formulae for skewness and coefficient come from ",Object(b.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://pubmed.ncbi.nlm.nih.gov/26977812/",children:"this open-access publication"})," in ophthalmology."]}),Object(b.jsx)("li",{children:"More citations can be found as comments in the source code."})]})]})};n(76);var m=function(e){var t=e.positionsObj,n=t.areas,a=t.coefficient,r=t.skewness;function i(e){try{var t=document.querySelector(e);t.setAttribute("xmlns","http://www.w3.org/2000/svg");var n=t.outerHTML,a=new Blob([n],{type:"image/svg+xml"});return URL.createObjectURL(a)}catch(r){alert("Couldn't load the SVGs. Check your browser security settings."),window.location.reload()}}function c(e){try{var t=new Blob([e],{type:"text/csv;charset=utf-8;"});return URL.createObjectURL(t)}catch(n){alert("Couldn't load the CSVs. Check your browser security settings."),window.location.reload()}}for(var s="",o=0;o<n.length;o++){var l=n[o].toString();if(0!==o){if(o===n.length-1){s=s.concat(l);break}s=s.concat(l,"\n")}else s="areas\n".concat(l,"\n")}var d=i(".diagram-container svg"),h=i(".graph-container svg"),f=c(s),j=c("coefficient\n".concat(a)),p=c("skewness\n".concat(r));return Object(b.jsxs)("div",{className:"downloads-container",children:[Object(b.jsxs)("div",{className:"row",children:[Object(b.jsx)("a",{download:"diagram.svg",href:d,children:Object(b.jsx)("img",{src:u,alt:"download diagram"})}),Object(b.jsx)("span",{children:"Diagram"}),Object(b.jsx)("span",{children:"svg"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsx)("a",{download:"histogram.svg",href:h,children:Object(b.jsx)("img",{src:u,alt:"download histogram"})}),Object(b.jsx)("span",{children:"Histogram"}),Object(b.jsx)("span",{children:"svg"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsx)("a",{download:"areas.csv",href:f,children:Object(b.jsx)("img",{src:u,alt:"download areas"})}),Object(b.jsx)("span",{children:"Areas"}),Object(b.jsx)("span",{children:"csv"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsx)("a",{download:"coefficient.csv",href:j,children:Object(b.jsx)("img",{src:u,alt:"download coefficient"})}),Object(b.jsx)("span",{children:"Coefficient"}),Object(b.jsx)("span",{children:"csv"})]}),Object(b.jsxs)("div",{className:"row",children:[Object(b.jsx)("a",{download:"skewness.csv",href:p,children:Object(b.jsx)("img",{src:u,alt:"download skewness"})}),Object(b.jsx)("span",{children:"Skewness"}),Object(b.jsx)("span",{children:"csv"})]})]})};var x=function(e){var t=Object(a.useState)(""),n=Object(s.a)(t,2),r=n[0],i=n[1],c=Object(a.useRef)(null);function h(t){t.preventDefault(),"help"!==t.target.alt?e.openPopup(Object(b.jsx)(m,{}),"Downloads"):e.openPopup(Object(b.jsx)(p,{}))}return Object(b.jsxs)("div",{className:"footer",children:[Object(b.jsx)("input",{ref:c,id:"hidden-file-input",type:"file",accept:".csv",onChange:function(t){try{e.closePopup();var n=t.target;if(!n.files.length)return;var a=URL.createObjectURL(n.files[0]);i(n.files[0].name),Object(l.d)(a).then((function(t){URL.revokeObjectURL(a);var n=t.map((function(e){var t=parseFloat(e.x),n=parseFloat(e.y);if(Number.isNaN(t)||Number.isNaN(n)||t===1/0||n===1/0)throw new Error('Invalid input: Please make sure the first record is a header with the field names "x" and "y" exactly. The rest should be a pair of real numbers (e.g. 1.23, 10.5).');return[t,n]}));e.positionsCallBack(n)})).catch((function(e){alert(e),window.location.reload()}))}catch(r){alert("Failed to upload file. Please try again."),window.location.reload()}}}),Object(b.jsxs)("div",{id:"displayed-file-input",children:[Object(b.jsx)("button",{onClick:function(){c.current.click()},children:"Upload csv file"}),Object(b.jsx)("span",{children:r})]}),Object(b.jsx)("input",{id:"download-button",type:"image",src:d,alt:"download",onClick:h}),Object(b.jsx)("input",{id:"help-button",type:"image",src:o,alt:"help",onClick:h})]})};var v=function(){var e=[];function t(t,n,a){for(var r=0;r<t;r++){var i=[Math.random()*n+a,Math.random()*n+a];e.push(i)}}return t(70,200,400),t(400,1e3,0),e};var O=function(e){return e.reduce((function(e,t){var n=t[0],a=t[1];return{min:[Math.min(n,e.min[0]),Math.min(a,e.min[1])],max:[Math.max(n,e.max[0]),Math.max(a,e.max[1])]}}),{min:[1/0,1/0],max:[-1/0,-1/0]})};var g=function(e){for(var t=e.vectors,n=[],a=0;a<t.length;a+=4)0!==t[a]||0!==t[a+1]?n.push(!1):n.push(!0);return n},w=n(9);function y(e,t,n){for(var a=0,r=n-1,i=0;i<n;i++)a+=(e[r]+e[i])*(t[r]-t[i]),r=i;return Math.abs(a/2)}var k=function(e,t){for(var n=[],a=[],r=0,i=Object(w.a)(e.cellPolygons()),c=0;c<t.length;c++)if(!0===t[c]){var s=i[c];s.pop();var o=y(s.map((function(e){return e[0]})),s.map((function(e){return e[1]})),s.length);n.push({area:o,voronoiIndex:c}),a.push(o),r+=o}return{areasObjs:n,areas:a,totalArea:r}},N=n(97);var C=function(e,t,n){for(var a=e.areasObjs,r=(e.areas,e.totalArea),i=a.length,c=r/i,s=0,o=0,l=0,d=0,h=[],f=function(e){var r=a[e].area-c;s+=Math.pow(r,3),o+=Math.pow(r,2);var i=Object(w.a)(t.neighbors(a[e].voronoiIndex)).filter((function(e){return!0===n[e]}));if(i.length<=1)return"continue";d+=a[e].area,h.push(a[e].area);var f=[],u=0;i.forEach((function(e){var t=a.find((function(t){return t.voronoiIndex===e})).area;f.push(t),u+=t}));var j=u/i.length,b=Object(N.a)(f);l+=j/b},u=0;u<i;u++)f(u);var j=s*(1/i)/Math.pow(o*(1/i),1.5);return 1===h.length?{skewness:j,coefficient:"error"}:{skewness:j,coefficient:d/(Object(N.a)(h)*l)}},M=n(4);n(85);var S=function(e){for(var t=e.areas,n=t.reduce((function(e,t){return Math.max(e,t)}),0),r=t.length,i=Math.min(r,100),c=n/i,s=[],o=0,d=0;d<i;d++){var h=o+c;s.push({interval:[o,h],areas:[],percentage:0,startPt:1*o.toFixed(3)}),o=h}var f,u=Object(M.a)(t);try{for(u.s();!(f=u.n()).done;){var j,p=f.value,m=Object(M.a)(s);try{for(m.s();!(j=m.n()).done;){var x=j.value,v=x.interval;if(p>=v[0]&&p<=v[1]){x.areas.push(p);break}}}catch(g){m.e(g)}finally{m.f()}}}catch(g){u.e(g)}finally{u.f()}var O=0;return s.forEach((function(e){e.percentage=e.areas.length/r*100,O=Math.max(O,e.percentage)})),Object(a.useEffect)((function(){var e={top:10,right:10,bottom:60,left:50},t=500-e.left-e.right,a=500-e.top-e.bottom;document.querySelector(".graph-container").innerHTML="";var r=l.f(".graph-container").append("svg").attr("viewBox","0 0 ".concat(t+e.left+e.right," ").concat(a+e.top+e.bottom)).append("g").attr("transform","translate("+e.left+","+e.top+")"),o=l.e().range([0,t]).domain([0,n+c]);r.append("g").attr("transform","translate(0,"+a+")").call(l.b(o)).append("path").selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end"),r.append("text").attr("transform","translate("+t/2+" ,"+(a+e.top+e.bottom-19)+")").style("text-anchor","middle").text("Area");var d=l.e().domain([0,O]).range([a,0]);r.append("g").call(l.c(d)),r.append("text").attr("transform","rotate(-90)").attr("y",-49).attr("x",0-a/2).attr("dy","1em").style("text-anchor","middle").text("Percentage of cells"),r.selectAll("mybar").data(s).enter().append("rect").attr("x",(function(e){return o(e.startPt)})).attr("width",t/i-1).attr("fill","#69b3a2").attr("height",(function(e){return a-d(0)})).attr("y",(function(e){return d(0)})).attr("transform","translate(5, 0)"),r.selectAll("rect").transition().duration(800).attr("y",(function(e){return d(e.percentage)})).attr("height",(function(e){return a-d(e.percentage)})).delay((function(e,t){return 10*t})),l.g("rect").lower()}),[t]),Object(b.jsx)("div",{className:"graph-container"})};n(86);var A=function(e){var t=e.positions,n=e.apices,r=Object(w.a)(t),i=[n.max[0],n.max[1]];if(n.min[0]<0||n.min[1]<0){var c=0,s=0;n.min[0]<0&&(c=-1*n.min[0]),n.min[1]<0&&(s=-1*n.min[1]),r=r.map((function(e){return[e[0]+c,e[1]+s]})),i=[i[0]+c,i[1]+s]}var o=Math.max(i[0],i[1]),d=1e3,h=1e3,f=d/o,u=(r=r.map((function(e){return[e[0]*f,e[1]*f]}))).slice(0,3);return Object(a.useEffect)((function(){document.querySelector(".diagram-container").innerHTML="";var e=l.f(".diagram-container").append("svg").attr("viewBox",[0,0,d,h]).attr("stroke-width",2),t=l.a.from(u).voronoi([0,0,d,h]);e.append("g").selectAll("circle").data(r).join("circle").attr("cx",(function(e){return e[0]})).attr("cy",(function(e){return e[1]})).attr("r",1).attr("fill","black");var n=e.append("path").attr("fill","none").attr("stroke","black").attr("stroke-width",1).attr("d",t.render());for(var a=function(e){if(e<3)return"continue";setTimeout((function(){u.push(r[e]),function(e){var t=l.a.from(e).voronoi([0,0,d,h]);n.attr("d",t.render())}(u)}),2*e)},i=0;i<r.length;i++)a(i)}),[t,n]),Object(b.jsx)("div",{className:"diagram-container"})},L=n(36),P=n.n(L);n(92);var T=function(e){var t=e.name,n=e.value,a=function(e){var t=e.toString().split(".");return 1===t.length?0:t[1].length}(n);return Object(b.jsxs)("div",{className:"calculations-container",children:[Object(b.jsx)("span",{className:"value-name",children:t}),Object(b.jsx)(P.a,{className:"value",start:0,end:n,duration:1,decimals:a})]})},E=(n(93),n.p+"static/media/close.244b6687.svg");var U=function(e){var t=e.obj,n=t.isOpen,r=t.child,i=Object(a.useRef)(null);return Object(a.useEffect)((function(){i.current.hidden=!n})),Object(b.jsxs)("div",{hidden:!0,ref:i,id:"popup",children:[Object(b.jsx)("input",{className:"close-button",type:"image",src:E,alt:"close",onClick:e.close}),Object(b.jsx)("div",{className:"popup-window",children:Object(b.jsx)("div",{className:"popup-content-container",children:Object(b.jsx)("div",{children:r})})})]})};var B=function(){function e(e){var t=O(e),n=100,a=l.a.from(e).voronoi([t.min[0]-n,t.min[1]-n,t.max[0]+n,t.max[1]+n]),r=g(a),i=k(a,r);if(0===i.areas.length)throw new Error("There are no finite cells to calculate areas for. Please try adding more coordinates.");var c=C(i,a,r),s=c.skewness,o=c.coefficient;if("error"===o)throw new Error("There is only 1 finite area, so the clustering coefficient could not be calculated. Please try adding more coordinates.");return{positions:e,apices:t,areas:i.areas,skewness:s,coefficient:o}}var t=Object(a.useState)(e(v())),n=Object(s.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)({isOpen:!1,child:Object(b.jsx)("div",{})}),o=Object(s.a)(c,2),d=o[0],h=o[1];function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"notDownloads",n=e;"Downloads"===t&&(n=Object(b.jsx)(m,{positionsObj:r})),h({isOpen:!0,child:n})}function u(){h({isOpen:!1,child:Object(b.jsx)("div",{})})}Object(a.useEffect)((function(){window.addEventListener("keydown",(function(e){"Escape"===e.key&&u()}))}),[]);var j=Object(b.jsx)(A,{positions:r.positions,apices:r.apices}),p=Object(b.jsx)(T,{name:"Skewness",value:r.skewness}),w=Object(b.jsx)(T,{name:"Coefficient",value:r.coefficient}),y=Object(b.jsx)(S,{areas:r.areas});return Object(b.jsxs)("div",{className:"container",children:[Object(b.jsx)(U,{obj:d,close:u}),Object(b.jsxs)("div",{className:"centered-container",children:[Object(b.jsx)("div",{className:"cell",onClick:function(){return f(j)},children:j}),Object(b.jsx)("div",{className:"cell",onClick:function(){return f(p)},children:p}),Object(b.jsx)("div",{className:"cell",onClick:function(){return f(w)},children:w}),Object(b.jsx)("div",{className:"cell",onClick:function(){return f(y)},children:y})]}),Object(b.jsx)(x,{positionsCallBack:function(t){try{var n=e(t);i(n)}catch(a){alert(a),window.location.reload()}},openPopup:f,closePopup:u})]})};c.a.render(Object(b.jsx)(r.a.StrictMode,{children:Object(b.jsx)(B,{})}),document.getElementById("root"))}},[[94,1,2]]]);
//# sourceMappingURL=main.6921ef4d.chunk.js.map